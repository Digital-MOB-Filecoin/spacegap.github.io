(this.webpackJsonpspacegap=this.webpackJsonpspacegap||[]).push([[0],{100:function(e,t){},112:function(e,t){},114:function(e,t){},151:function(e,t,a){},152:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(82),i=a.n(c),s=(a(91),a(1)),o=a.n(s),l=a(4),u=a(3),d=a(10),m=a(9),p=a(6),h=a(15),f=a(7),v=a(8),E=a(2),w=a(57),b=a(45),y=a(58),g=a.n(y),j=function(e){var t=288888888e10,a=Math.pow(2,1/1051200),n=1/Math.log(a),r=-t*n;return Math.log((e-r)/(t*n))/Math.log(a)},O=function(e,t,a,n){var r=Math.log(2)/6307200,c=33e7*(1-Math.pow(Math.E,-r*t)),i=33e7*(1-Math.pow(Math.E,-r*e)),s=77e7*(1-Math.pow(Math.E,-r*n));return i+77e7*(1-Math.pow(Math.E,-r*a))-c-s},x=function(e){var t=Math.pow(2,1/1051200);return 288888888e10*Math.pow(t,e)},S=function(){function e(t){var a=t.currEpoch,n=t.nwqap,r=t.nwqapP,c=t.nwqapV,i=t.nwCircSupply,s=t.perEpochRewardP,o=t.perEpochRewardV,l=t.perDurationNwRbGrowth,u=t.projectedDays,d=t.perDurationMinerQaGrowth,m=t.nwCumsumRealized;Object(f.a)(this,e),Object.assign(this,{currEpoch:a,nwqap:n,nwqapP:r,nwqapV:c,nwCircSupply:i,perEpochRewardP:s,perEpochRewardV:o,perDurationNwRbGrowth:l,projectedDays:u,perDurationMinerQaGrowth:d,nwCumsumRealized:m})}return Object(v.a)(e,[{key:"projectFutureReward",value:function(e,t){var a=new k(this.nwqapP,this.nwqapV),n=new k(this.perEpochRewardP,this.perEpochRewardV);return e*N(n,a,2880*t)}},{key:"computeInitialPledgeForQAPower",value:function(e,t){return this.projectFutureReward(e,20)+.3*e*this.nwCircSupply/Math.max(this.nwqap,x(t))}},{key:"summary",value:function(){return{sectorIp:this.computeInitialPledgeForQAPower(32*Math.pow(2,30),this.currEpoch),sectorProjectedReward:this.projectFutureReward(32*Math.pow(2,30),360),sectorFaultFee:this.projectFutureReward(32*Math.pow(2,30),3.51)}}},{key:"computeInitialPledgeFromAssumptions",value:function(){for(var e=this.currEpoch,t=this.nwqap,a=this.nwqapP,n=this.nwqapV,r=this.nwCircSupply,c=this.perEpochRewardP,i=this.perEpochRewardV,s=this.perDurationNwRbGrowth,o=this.projectedDays,l=this.perDurationMinerQaGrowth,u=this.nwCumsumRealized,d=new k(a,n),m=new k(c,i),p=s/o/2880,h=l/o/2880,f=[],v=0,E=t,w=u,b=j(u),y=e+1;y<e+2880*o+1;y++){var g=h*(N(m,d,57600)+.3*r/Math.max(E,x(y)));f.push(g),v+=g;var S=j(w+=E+=p),P=O(y,y-1,S,b);m.addNewEntry(P,1),d.addNewEntry(E,1),b=S}return{newInitialPledges:f,totalInitialPledge:v}}}]),e}(),k=function(){function e(t,a){Object(f.a)(this,e),this.alpha=925e-6,this.beta=284e-9,this.p=t,this.v=a}return Object(v.a)(e,[{key:"addNewEntry",value:function(e,t){this.p+=this.v*t;var a=e-this.p;this.p+=this.alpha*a,this.p=Math.max(this.p,0),this.v+=this.beta*a/t}}]),e}(),N=function(e,t,a){var n=Math.log(t.p+t.v),r=Math.log(t.p+t.v+t.v*a);return(t.v*e.p*(r-n)+e.v*(t.p*(n-r)+t.v*a))/Math.pow(t.v,2)},P=(a(28),a(22)),C=a.n(P),F=a(28),I=F.format("0.2f"),D=a(145)("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),R=a(35),M=a(154).testnet.fullNode;function T(e){if(""===e)return window.BigInt(0);var t=atob(e),a=[];return t.split("").forEach((function(e){var t=e.charCodeAt(0).toString(16);t.length%2&&(t="0"+t),a.push(t)})),window.BigInt("0x"+a.join(""))}var H=function(e){return console.log(">>>> HEIGHT",e),!e||e>=138720?{Sectors:"buffer",Unproven:"buffer",Faults:"buffer",Recoveries:"buffer",Terminated:"buffer",ExpirationEpochs:"cid",EarlyTerminated:"cid",LivePower:{a:"bigint",b:"bigint"},UnprovenPower:{a:"bigint",b:"bigint"},FaultyPower:{a:"bigint",b:"bigint"},RecoveringPower:{a:"bigint",b:"bigint"}}:{Sectors:"buffer",Faults:"buffer",Recoveries:"buffer",Terminated:"buffer",ExpirationEpochs:"cid",EarlyTerminated:"cid",LivePower:{a:"bigint",b:"bigint"},FaultyPower:{a:"bigint",b:"bigint"},RecoveringPower:{a:"bigint",b:"bigint"}}},A={type:"hamt",key:"bigint",value:{info:{seal_proof:"int",sector_number:"int",sealed_cid:"cid",seal_rand_epoch:"int",deal_ids:["list","int"],expiration:"int",replace_capacity:"bool",replace_sector_deadline:"int",replace_sector_partition:"int",replace_sector_number:"int"},precommit_deposit:"bigint",precommit_epoch:"int",deal_weight:"bigint",verified_deal_weight:"bigint"}};function L(e){for(var t=0n,a=0;a<e.length;a++)t*=256n,t+=window.BigInt(e[a]);return t}function B(e){for(var t=new R(0),a=0;a<e.length;a++)t=(t=t.mul(new R(256))).add(new R(e[e.length-a-1]));return t}function G(e,t){var a=e.num.and(new R(1).shln(t).sub(new R(1)));return e.num=e.num.shrn(t),e.left-=t,a.toNumber()}function Q(e){var t,a=function(e){for(var t={left:8*e.length,num:B(e)},a=(G(t,2),G(t,1)),n=[];t.left>0;){if(1!==G(t,1))if(1!==G(t,1)){for(var r=0,c=0,i=0;;i++){if(10===i)throw new Error("run too long");var s=G(t,8);if(s<128){if(i>9||9===i&&s>1)throw new Error("run too long");if(0===s&&c>0)throw new Error("invalid run");r|=s<<c;break}r|=(127&s)<<c,c+=7}n.push(r)}else{var o=G(t,4);n.push(o)}else n.push(1)}return{first:a,runs:n}}(e),n=a.first,r=a.runs,c=n,i=[],s=0,o=Object(E.a)(r);try{for(o.s();!(t=o.n()).done;){for(var l=t.value,u=0;u<l;u++)1===c&&i.push(s),s++;c=1-c}}catch(d){o.e(d)}finally{o.f()}return i}var _=function(){function e(t){Object(f.a)(this,e),this.url=t;var a=new b.a(t);console.log("new endpoint",t),this.client=new w.LotusRPC(a,{schema:M})}return Object(v.a)(e,[{key:"getData",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a,n){var r,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.Blocks[0].ParentStateRoot["/"],c=t.Height>=138720?"".concat(r,"/1/").concat(a):"".concat(r,"/").concat(a),e.next=4,this.client.chainGetNode(c);case 4:return i=e.sent.Obj,s=this,e.next=8,g.a.methods.decode(n,i).asObject(function(){var e=Object(l.a)(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.client.chainGetNode(t);case 2:return a=e.sent,e.abrupt("return",a.Obj);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"fetchHead",value:function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.chainHead();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchPartitionsSectors",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.chainGetNode("".concat(t["/"]));case 2:return n=e.sent.Obj[2][2],e.abrupt("return",n.map((function(e){var t=g.a.methods.decode(H(a),e);return[{Sectors:Q(t.Sectors),Faults:Q(t.Faults).reduce((function(e,t){return e[t]=!0,e}),{}),Terminated:Q(t.Terminated).reduce((function(e,t){return e[t]=!0,e}),{}),Recoveries:Q(t.Recoveries).reduce((function(e,t){return e[t]=!0,e}),{})}]})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchTipsetHead",value:function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.ChainGetTipSetByHeight(t,null);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchPower",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.Blocks[0].ParentStateRoot["/"],n=t.Height>=138720?"".concat(a,"/1/@Ha:t04/1"):"".concat(a,"/@Ha:t04/1"),e.next=4,this.client.chainGetNode(n);case 4:return r=e.sent.Obj,e.abrupt("return",{TotalRawBytePower:L(D.decode(r[0])),TotalBytesCommitted:L(D.decode(r[1])),TotalQualityAdjPower:L(D.decode(r[2])),TotalQABytesCommitted:L(D.decode(r[3])),TotalPledgeCollateral:L(D.decode(r[4])),ThisEpochRawBytePower:L(D.decode(r[5])),ThisEpochQualityAdjPower:L(D.decode(r[6])),ThisEpochPledgeCollateral:L(D.decode(r[7]))});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchDeposits",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a){var n,r,c,i,s,l,u,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.StateReadState(t,a.Cids);case 2:return n=e.sent,r=n.State,c=n.Balance,i=r.PreCommitDeposits,s=r.LockedFunds,l=r.InitialPledge,u=r.FeeDebt,d=c-l-i-s,e.abrupt("return",{Balance:I(c/1e18),InitialPledge:I(l/1e18),Available:I(d/1e18),LockedFunds:I(s/1e18),PreCommitDeposits:I(i/1e18),FeeDebt:I(u/1e18)});case 7:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getMiners",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.localStorage.getItem("miners"),a=window.localStorage.getItem("time"),!(t&&a&&Date.now()-+a>6e4)){e.next=4;break}return e.abrupt("return",JSON.parse(t));case 4:return e.next=6,fetch("https://filfox.info/api/v0/miner/list/power?pageSize=1000");case 6:return e.next=8,e.sent.json();case 8:return n=e.sent,r=n.miners.reduce((function(e,t){return e[t.address]=t,e}),{}),window.localStorage.setItem("miners",JSON.stringify(r)),window.localStorage.setItem("time",Date.now()),e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchDeadlinesProxy",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a){var n,r,c,i,s=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.Blocks[0].ParentStateRoot["/"],r=a.Height>=138720?"".concat(n,"/1/@Ha:").concat(t,"/1/12"):"".concat(n,"/@Ha:").concat(t,"/1/11"),e.next=4,this.client.chainGetNode(r);case 4:return c=e.sent.Obj[0],e.next=7,C()(24,c,function(){var e=Object(l.a)(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.client.ChainGetNode("".concat(t["/"]));case 2:return a=e.sent.Obj,e.abrupt("return",{Partitions:a[0],LiveSectors:a[4],TotalSectors:a[5],FaultyPower:{Raw:Number(T(a[6][0]))}});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchMinerInfo",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.StateMinerInfo(t,a.Cids));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchDeadlines",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a){var n,r,c,i,s,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.client.StateMinerProvingDeadline(t,a.Cids),this.fetchDeadlinesProxy(t,a)]);case 2:return n=e.sent,r=Object(u.a)(n,2),c=r[0],i=r[1],console.log(">>> got deadline and deadline"),s=Object(h.a)(Array(48)).map((function(e,t){return Object(p.a)(Object(p.a)({},i[(c.Index+t)%48]),{},{Close:c.Close+60*t,Index:(c.Index+t)%48})})),l=i.map((function(e){return+e.LiveSectors})).reduce((function(e,t){return e+t}),0),d=i.map((function(e){return+e.FaultyPower.Raw})).reduce((function(e,t){return e+t}),0)/34359738368,e.abrupt("return",{deadlines:i.map((function(e,t){return Object(p.a)(Object(p.a)({},i[t]),{},{Close:c.Close+60*t,Index:t})})),nextDeadlines:s,SectorsCount:l,FaultsCount:d,ActiveCount:l-d,deadline:c});case 11:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchPreCommittedSectors",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a){var n,r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.Height>=138720?"@Ha:".concat(t,"/1/6"):"@Ha:".concat(t,"/1/5"),e.next=3,this.getData(a,n,A);case 3:return r=e.sent,c=F.groups(Object.keys(r).map((function(e){return{SectorNumber:r[e].info.sector_number,Expiry:r[e].precommit_epoch+10210}})),(function(e){return e.Expiry})).map((function(e){var t=Object(u.a)(e,2);return{Expiry:t[0],Sectors:t[1].map((function(e){return e.SectorNumber}))}})).sort((function(e,t){return e.Expiry-t.Expiry})),e.abrupt("return",{PreCommitDeadlines:c,Count:Object.keys(r).length});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchSectors",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a){var n,r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.StateMinerSectors(t,null,a.Cids);case 2:return n=e.sent,r=n.reduce((function(e,t){return e[t.ID]={number:t.ID,info:t},e}),{}),c=Object.keys(r).length,e.abrupt("return",{sectorsCount:c,Sectors:r});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchGenesisActors",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var a,n,r,c,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.client.StateCirculatingSupply(t.Cids),this.client.StateReadState("f02",t.Cids),this.client.StateReadState("f04",t.Cids)]);case 2:return a=e.sent,n=Object(u.a)(a,3),r=n[0],c=n[1],i=n[2],e.abrupt("return",{Supply:r,Reward:c,Power:i});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeEconomics",value:function(e,t,a){var n=t.Supply,r=t.Reward,c=t.Power,i=a.projectedDays,s=a.perDurationNwRbGrowth,o=void 0===s?10*Math.pow(2,50):s,l=a.perDurationMinerQaGrowth,u=void 0===l?Math.pow(2,51):l,d={currEpoch:+e.Height,nwqap:+c.State.ThisEpochQualityAdjPower,nwqapP:+c.State.ThisEpochQAPowerSmoothed.PositionEstimate/Math.pow(2,128),nwqapV:+c.State.ThisEpochQAPowerSmoothed.VelocityEstimate/Math.pow(2,128),nwCircSupply:+n.FilCirculating/1e18,perEpochRewardP:+r.State.ThisEpochRewardSmoothed.PositionEstimate/(1e18*Math.pow(2,128)),perEpochRewardV:+r.State.ThisEpochRewardSmoothed.VelocityEstimate/(1e18*Math.pow(2,128)),nwCumsumRealized:+r.State.CumsumRealized,perDurationNwRbGrowth:o,projectedDays:i,perDurationMinerQaGrowth:u};return new S(d).summary()}}]),e}();function q(e){var t=e.title,a=e.url,n=e.desc;return r.a.createElement("div",{className:"summary col-sm"},r.a.createElement("div",{className:"summary-title"},a?r.a.createElement("a",{href:a},t):r.a.createElement(r.a.Fragment,null,t)),r.a.createElement("div",{className:"summary-desc"},n))}var V=a(28),W=(V.format(","),V.format(",.3f"));function z(e){var t=e.miners,a=e.client,c=e.head,i=Object(n.useState)(),s=Object(u.a)(i,2),m=s[0],p=s[1];return Object(n.useEffect)((function(){c&&function(){var e=Object(l.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.fetchGenesisActors(c);case 2:t=e.sent,n=a.computeEconomics(c,t,{projectedDays:1}),console.log("summary",n),p(n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[a,c]),r.a.createElement("section",{id:"home",className:"container"},r.a.createElement("div",{className:"spacerace"},r.a.createElement("h3",null,"Top miners"),t&&Object.keys(t).slice(0,5).map((function(e,a){return r.a.createElement("div",{key:a},a+1,"."," ",r.a.createElement(d.b,{to:"/miners/".concat(t[e].address)},t[e].address))})),r.a.createElement("div",null,"See deadlines of ",r.a.createElement(d.b,{to:"/full"},"top 50 miners")," or click on individual miners or the ",r.a.createElement(d.b,{to:"/status"},"network status"),".")),m&&r.a.createElement("div",{id:"deposits",className:"section"},r.a.createElement("h3",null,"Economics"),r.a.createElement("div",{className:"grid"},m&&r.a.createElement(q,{title:"".concat(W(m.sectorIp||0)," FIL"),desc:"Pledge"}),m&&r.a.createElement(q,{title:"".concat(W(m.sectorProjectedReward||0)," FIL"),desc:"Daily Reward"}),m&&r.a.createElement(q,{desc:"Fault Fee",title:"".concat(W(m.sectorFaultFee||0)," FIL")})),"These numbers are approximate projections based on the current network state and may be incorrect, do your own research. All costs are per sector."))}function J(e){var t=e.deadline,a=e.head,n=t;return r.a.createElement("div",{className:"deadlines windowpost"},r.a.createElement("div",{className:0===n.LiveSectors?"deadline opacity5":"deadline"},r.a.createElement("div",{className:"out"},"In ",n.Close-a.Height),r.a.createElement("div",{className:"hddWrapper"},r.a.createElement("div",{className:"in"},Math.round(32*n.LiveSectors/1024)," TiB"),r.a.createElement("div",{className:"hdds"},Object(h.a)(Array(Math.ceil(Math.round(32*n.LiveSectors/1024-+n.FaultyPower.Raw/1099511627776)/8))).map((function(e,t){return r.a.createElement("div",{key:t,className:"hdd"}," ")})),Object(h.a)(Array(Math.ceil(Math.round(+n.FaultyPower.Raw/1099511627776)/8))).map((function(e,t){return r.a.createElement("div",{key:t,className:"hdd faulty"}," ")}))))))}var U=a(28).format(",.2f");function K(e){var t=e.client,a=e.spa,c=e.head,i=e.miners,s=Object(n.useState)({}),m=Object(u.a)(s,2),h=m[0],f=m[1],v=Object(n.useState)({}),E=Object(u.a)(v,2),w=E[0],b=E[1],y=Object(n.useState)(),g=Object(u.a)(y,2),j=g[0],O=g[1],x=Object(n.useState)(),S=Object(u.a)(x,2),k=S[0],N=S[1];return Object(n.useEffect)((function(){c&&function(){var e=Object(l.a)(o.a.mark((function e(){var a,n,r,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=Object(l.a)(o.a.mark((function e(a){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchTipsetHead(c.Height-a);case 2:return n=e.sent,e.next=5,t.fetchPower(n);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=3,Promise.all([a(60),a(120)]);case 3:return n=e.sent,r=Object(u.a)(n,2),i=r[0],s=r[1],e.next=9,O(i);case 9:return e.next=11,N(s);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[c]),Object(n.useEffect)((function(){var e=!0;if(c){var a=Object.keys(i).slice(0,40).map((function(e){return i[e].address}));return C()(5,a,function(){var a=Object(l.a)(o.a.mark((function a(n){var r,i,s;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,t.fetchDeadlines(n,c);case 4:if(r=a.sent,e){a.next=7;break}return a.abrupt("return");case 7:return a.next=9,t.fetchTipsetHead(c.Height-2880);case 9:if(i=a.sent,e){a.next=12;break}return a.abrupt("return");case 12:return a.next=14,t.fetchDeadlines(n,i);case 14:if(s=a.sent,e){a.next=17;break}return a.abrupt("return");case 17:return h[n]=r,w[n]=s,a.next=21,f(Object(p.a)({},h));case 21:return a.next=23,b(Object(p.a)({},w));case 23:return a.abrupt("return",a.sent);case 24:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()),function(){e=!1}}}),[t,c,i]),r.a.createElement("section",{className:"container"},r.a.createElement("div",{id:"deposits",className:"section"},r.a.createElement("div",{className:"grid"},a&&r.a.createElement(r.a.Fragment,null,r.a.createElement(q,{title:U(parseInt(a.TotalQualityAdjPower)/0x4000000000000),desc:"Total QA Power"})),j&&a&&r.a.createElement(r.a.Fragment,null,r.a.createElement(q,{title:U(parseInt(a.TotalQualityAdjPower-j.TotalQualityAdjPower)/0x4000000000000),desc:"60 Epochs delta"})),k&&a&&r.a.createElement(r.a.Fragment,null,r.a.createElement(q,{title:U(parseInt(a.TotalQualityAdjPower-k.TotalQualityAdjPower)/0x4000000000000),desc:"120 Epochs delta"})))),"Listing WindowPoSt duties of the top 50 miners.",i&&Object.keys(i).slice(0,40).map((function(e,t){return r.a.createElement("div",{className:"flex",key:t},r.a.createElement(d.b,{to:"/miners/".concat(i[e].address)},i[e].address),h&&h[i[e].address]&&r.a.createElement(J,{head:c,deadline:h[i[e].address].nextDeadlines[47]}),w&&w[i[e].address]&&r.a.createElement(J,{head:c,deadline:w[i[e].address].nextDeadlines[47]}))})))}function Z(e){var t=e.minerId,a=e.deadlines,n=e.head,c=e.link,i=e.out;return c||(c=function(e){return"/miners/".concat(t,"/deadlines/").concat(e.Index)}),i||(i=function(e){var t=e.d,a=e.head;e.i;return"In ".concat(t.Close-a.Height)}),n&&a?r.a.createElement("div",{className:"deadlines windowpost"},a&&a.map((function(e,t){return r.a.createElement("div",{key:t,className:0===e.LiveSectors?"deadline opacity5":"deadline"},r.a.createElement(d.b,{to:c(e)},r.a.createElement("div",{className:"out"},i({d:e,head:n,i:t})),r.a.createElement("div",{className:"hddWrapper"},r.a.createElement("div",{className:"in"},Math.round(32*e.LiveSectors/1024)," TiB"),r.a.createElement("div",{className:"hdds"},Object(h.a)(Array(Math.ceil(Math.round(32*e.LiveSectors/1024-+e.FaultyPower.Raw/1099511627776)/8))).map((function(e,t){return r.a.createElement("div",{key:t,className:"hdd"}," ")})),Object(h.a)(Array(Math.ceil(Math.round(+e.FaultyPower.Raw/1099511627776)/8))).map((function(e,t){return r.a.createElement("div",{key:t,className:"hdd faulty"}," ")}))))))}))):r.a.createElement(r.a.Fragment,null)}function X(e){var t=e.miners,a=e.client,c=Object(n.useState)({}),i=Object(u.a)(c,2),s=i[0],m=i[1],h=Object(n.useState)(),f=Object(u.a)(h,2),v=f[0],E=f[1];return Object(n.useEffect)((function(){(function(){var e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.fetchHead();case 2:t=e.sent,E(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[a]),Object(n.useEffect)((function(){var e=!0;if(v){var n=Object.keys(t).slice(0,50).map((function(e){return t[e].address}));return C()(5,n,function(){var t=Object(l.a)(o.a.mark((function t(n){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,a.fetchDeadlines(n,v);case 4:if(r=t.sent,e){t.next=7;break}return t.abrupt("return");case 7:return s[n]=r.nextDeadlines,t.next=10,m(Object(p.a)({},s));case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),function(){e=!1}}}),[a,v,t]),r.a.createElement("section",{id:"LookUp",className:"container"},"Listing WindowPoSt duties of the top 50 miners.",t&&Object.keys(t).slice(0,50).map((function(e,a){return r.a.createElement("div",{key:a},r.a.createElement(d.b,{to:"/miners/".concat(t[e].address)},t[e].address),r.a.createElement(Z,{deadlines:s[t[e].address],head:v}))})))}var Y=a(34);function $(e){e.client;var t=e.miners,a=e.minerId,n=e.deadlineId,c=e.miner;return r.a.createElement("div",{className:"section minerbar"},r.a.createElement("div",{className:"minerId"},!n&&r.a.createElement(r.a.Fragment,null,r.a.createElement(d.b,{to:"/miners/".concat(a)},a),r.a.createElement("span",{className:"tinyarrow"},r.a.createElement("a",{href:"https://filfox.info/en/address/".concat(a)},"\u2197")),c&&c.deposits&&0!==+c.deposits.FeeDebt&&r.a.createElement("span",{className:"rekt"},"DEBT")),n&&r.a.createElement(r.a.Fragment,null,r.a.createElement(d.b,{to:"/miners/".concat(a,"/deadlines/").concat(n)},"Deadline ",n))),n&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"backto"},r.a.createElement(d.b,{to:"/miners/".concat(a)},"See miner",r.a.createElement("span",{className:"bolder"}," ",a)))),!n&&r.a.createElement("div",null,t&&t[a]&&t[a].tag&&r.a.createElement("span",{className:"miner-name"},t[a].tag.name,t&&t[a].location&&r.a.createElement("span",null," ",t[a].location.flagEmoji))))}var ee=a(28),te=ee.format(","),ae=ee.format(",.1f");var ne=Object(m.g)((function(e){var t,a=e.miners,c=e.client,i=e.head,s=Object(m.f)(),d=s.minerId,f=s.deadlineId,v=Object(n.useState)(),E=Object(u.a)(v,2),w=E[0],b=E[1],y=Object(n.useState)({}),g=Object(u.a)(y,2),j=g[0],O=g[1],x=Object(n.useState)(),S=Object(u.a)(x,2),k=S[0],N=S[1];return Object(n.useEffect)((function(){k&&c.fetchPartitionsSectors(k.deadlines[f].Partitions).then((function(e){b(e)}))}),[k]),Object(n.useEffect)((function(){if(d&&i&&f){var e=Object(h.a)(Array(38)).map((function(e,t){return{height:i.Height-2880*t,day:t}}));if(!(k&&i.Height<k.deadlines[f].Close)){try{C()(40,e,function(){var e=Object(l.a)(o.a.mark((function e(t){var a,n,r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.day,n=t.height,e.prev=1,e.next=4,c.fetchTipsetHead(n);case 4:r=e.sent,e.next=7;break;case 7:return e.next=9,c.fetchDeadlines(d,r);case 9:i=e.sent,e.next=12;break;case 12:j[a]=i,O(Object(p.a)({},j)),0===a&&N(i),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),console.log("could not find",a,n);case 20:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t){return e.apply(this,arguments)}}())}catch(t){console.log("trouble with ",t)}return function(){!1}}console.log(i.Height,k.deadlines[f].Close)}}),[c,i,d,f,k]),r.a.createElement("section",{className:"container"},r.a.createElement($,{client:c,miners:a,minerId:d,deadlineId:f}),r.a.createElement("div",{className:"section wpost"},r.a.createElement("div",{className:"grid"},j&&j[0]&&r.a.createElement(q,{title:"".concat(ae(32*+j[0].deadlines[f].LiveSectors/1024)," TiB"),desc:"".concat(te(j[0].deadlines[f].LiveSectors)," Live Sectors")}),j&&j[0]&&r.a.createElement(q,{title:"".concat(ae(+j[0].deadlines[f].FaultyPower.Raw/1099511627776)," TiB"),desc:"".concat(te(+j[0].deadlines[f].FaultyPower.Raw/34359738368)," Faulty Sectors")}))),r.a.createElement("div",{className:"section wpost"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col section-title"},r.a.createElement("h3",null,"History"),r.a.createElement("a",{"data-tip":!0,"data-for":"wpost-desc"},"(what is this?)"),r.a.createElement(Y.a,{id:"wpost-desc",effect:"solid",place:"top"},r.a.createElement("span",null,"List of 48 WindowPoSt submission deadlines ordered by due time (in epochs).",r.a.createElement("br",null),"Bars represent ~8TB disks to be proven, white are healthy disks, red are faulty.")))),r.a.createElement(Z,{link:function(e){return"/miners/".concat(d,"/deadlines/").concat(f)},deadlines:(t=f,Object.keys(j).sort((function(e,t){return+e-+t})).map((function(e){return[e,j[e]]})).map((function(e){var a=Object(u.a)(e,2);return a[0],a[1].deadlines[t]})).flat()),head:i,out:function(e){e.d,e.head;var t=e.i;return 0===t?"Today":"".concat(t,"d ago")}})),r.a.createElement("div",{className:"section sectors"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col section-title"},r.a.createElement("h3",null,"Sectors"),r.a.createElement("a",{"data-tip":!0,"data-for":"sectors-desc"},"(what is this?)"),r.a.createElement(Y.a,{id:"sectors-desc",effect:"solid",place:"top"},r.a.createElement("span",null,"Each square is a 32GiB sector.")))),w&&r.a.createElement("div",null,w.map((function(e,t){return r.a.createElement("div",{key:t},r.a.createElement("h4",null,"Partition ",t," ",Object.keys(e[0].Faults).length===e[0].Sectors.length&&r.a.createElement("span",{className:"rekt"},"REKT")),r.a.createElement("div",{className:"s-partition"},e[0].Sectors.map((function(t){return r.a.createElement("div",{key:t,className:"s-sector ".concat(e[0].Faults[t]&&"faulty"," ").concat(e[0].Terminated[t]&&"terminated"," ").concat(e[0].Recoveries[t]&&"recovering")},r.a.createElement("span",null,t))}))))})))))})),re=a(28),ce=re.format(","),ie=re.format(",.0f");var se=Object(m.g)((function(e){var t=e.client,a=e.miners,c=e.head,i=Object(m.f)().minerId,s=Object(n.useState)({id:i}),o=Object(u.a)(s,2),l=o[0],d=o[1];return Object(n.useEffect)((function(){if(i&&c&&t){var e=!0;return d(Object(p.a)({},l)),t.fetchMinerInfo(i,c).then((function(t){e&&(l.info=t,d(Object(p.a)({},l)))})).catch((function(e){console.error("failed to fetch miner info")})),t.fetchDeadlines(i,c).then((function(t){e&&(l.deadlines=t,d(Object(p.a)({},l)),console.log("deadlines setting"))})).catch((function(e){console.error("failed to fetch deadlines")})),t.fetchDeposits(i,c).then((function(t){e&&(l.deposits=t,d(Object(p.a)({},l)))})).catch((function(e){console.error("failed to fetch deposits")})),t.fetchPreCommittedSectors(i,c).then((function(t){e&&(l.preCommits=t,d(Object(p.a)({},l)))})).catch((function(e){console.error("failed to fetch precommitted sectors",e)})),function(){e=!1}}}),[t,c,i]),l&&c?r.a.createElement("section",{className:"container"},r.a.createElement($,{client:t,miners:a,minerId:i,miner:l}),r.a.createElement("div",{id:"deposits",className:"section"},r.a.createElement("div",{className:"grid"},l.deposits&&r.a.createElement(q,{title:"".concat(ce(l.deposits.Balance||0)," FIL"),desc:"Balance"}),l.deposits&&r.a.createElement(q,{title:"".concat(ce(l.deposits.Available||0)," FIL"),desc:"Available"}),l.deposits&&r.a.createElement(q,{desc:"Vesting",title:"".concat(ce(l.deposits.LockedFunds||0)," FIL")})),r.a.createElement("div",{className:"grid"},l.deposits&&r.a.createElement(q,{title:"".concat(ce(l.deposits.InitialPledge||0)," FIL"),desc:"Initial Pledge"}),l.deposits&&r.a.createElement(q,{desc:"PreCommit Deposit",title:"".concat(ce(l.deposits.PreCommitDeposits||0)," FIL")}),l.deposits&&r.a.createElement(q,{title:"".concat(ce(l.deposits.FeeDebt||0)," FIL"),desc:"Fee Debt"}))),r.a.createElement("div",{id:"sectors"},r.a.createElement("div",{className:"grid grid-4"},l.deadlines&&r.a.createElement(q,{title:"".concat(ie(32*l.deadlines.SectorsCount/1024)," TiB"),desc:"".concat(ce(l.deadlines.SectorsCount||0)," Total Sectors")}),l.deadlines&&r.a.createElement(q,{title:"".concat(ie(32*l.deadlines.ActiveCount/1024)," TiB"),desc:"".concat(ce(l.deadlines.ActiveCount||0)," Active Sectors")}),l.deadlines&&r.a.createElement(q,{title:"".concat(ie(32*l.deadlines.FaultsCount/1024)," TiB"),desc:"".concat(ce(l.deadlines.FaultsCount||0)," Faulty Sectors")}),l.preCommits&&r.a.createElement(q,{title:ce(l.preCommits.Count||0),desc:"PreCommits"}))),l.deadlines&&r.a.createElement("div",{className:"section wpost"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col section-title"},r.a.createElement("h3",null,"Deadlines"),r.a.createElement("a",{"data-tip":!0,"data-for":"wpost-desc"},"(what is this?)"),r.a.createElement(Y.a,{id:"wpost-desc",effect:"solid",place:"top"},r.a.createElement("span",null,"List of 48 WindoPoSt submission deadlines ordered by due time (in epochs).",r.a.createElement("br",null),"Bars represent ~8TB disks to be proven, white are healthy disks, red are faulty.")))),r.a.createElement(Z,{minerId:i,deadlines:l.deadlines.nextDeadlines,head:c})),l.deadlines&&r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col section-title"},r.a.createElement("h3",null,"Upcoming Deadline"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"timeline"}),r.a.createElement("ul",null,r.a.createElement("li",null,"PoStSubmissions:",l.deadlines.nextDeadlines[0].PostSubmissions),r.a.createElement("li",null,"Sectors to Prove:"," ",l.deadlines.nextDeadlines[0].LiveSectors),r.a.createElement("li",null,"Current Deadline: ",l.deadlines.deadline.Index),r.a.createElement("li",null,"FaultCutoff:"," ",l.deadlines.deadline.FaultCutoff-c.Height),r.a.createElement("li",null,"Challenge: ",l.deadlines.deadline.Challenge-c.Height),r.a.createElement("li",null,l.deadlines.deadline.Open-c.Height>0?"Open":"Opened",": ",l.deadlines.deadline.Open-c.Height),r.a.createElement("li",null,"Close: ",l.deadlines.deadline.Close-c.Height))),r.a.createElement("div",{className:"col"},r.a.createElement(Z,{minerId:i,deadlines:[l.deadlines.nextDeadlines[0]],head:c})))),l.preCommits&&r.a.createElement("div",{id:"provecommit",className:"section"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col section-title"},r.a.createElement("h3",null,"New sectors"),r.a.createElement("a",{"data-tip":!0,"data-for":"provecommit-desc"},"(what is this?)"),r.a.createElement(Y.a,{id:"provecommit-desc",effect:"solid",place:"top"},r.a.createElement("span",null,"List of ProveCommits ordered by due time (in epochs).",r.a.createElement("br",null),"Circles represent sectors to be proven.")))),r.a.createElement("div",{className:"deadlines provecommit"},l.preCommits.PreCommitDeadlines.map((function(e,t){return r.a.createElement("div",{key:t,className:"deadline"},r.a.createElement("div",{className:"out"},"In ",e.Expiry-c.Height),r.a.createElement("div",{className:"hddWrapper"},r.a.createElement("div",{className:"in"},Math.round(e.Sectors.length)," sectors"),r.a.createElement("div",{className:"hdds"},e.Sectors.map((function(e){return r.a.createElement("div",{key:e,className:"hdd"},"")})))))}))))):r.a.createElement(r.a.Fragment,null)})),oe=function(){return le.apply(this,arguments)};function le(){return(le=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api3.drand.sh/health");case 2:return e.next=4,e.sent.json();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ue=a(28).format(",");function de(){var e=new Date("2020-08-24 22:00:00Z").getTime();return Math.floor((Date.now()-e)/1e3/30)}function me(e){var t=e.client,a=e.head,c=Object(n.useState)(de()),i=Object(u.a)(c,2),s=i[0],d=i[1],m=Object(n.useState)(),p=Object(u.a)(m,2),h=p[0],f=p[1];return Object(n.useEffect)((function(){var e=!0,t=function(){var t=Object(l.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:oe().then((function(t){e&&(h&&t.current===h.current?console.log("   repeated drand, skip"):(console.log("   new drand",t),f(t)))})),de()!==s&&d(de());case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t();var a=setInterval((function(){e&&t()}),5e3);return function(){e=!1,clearInterval(a),console.log("removing interval")}}),[t,a,h]),r.a.createElement("div",{className:"tiny-grid"},a&&s&&r.a.createElement("div",null,"Filecoin Status"," ",r.a.createElement("span",null,a.Height<s?s-a.Height===1?"gathering blocks":"catching up":"ok")),a&&r.a.createElement("div",{className:"tiny"},"Current Tipset"," ",r.a.createElement("a",{href:"https://filfox.info/en/tipset/".concat(a.Height)},ue(a.Height))),s&&r.a.createElement("div",{className:"tiny"},"Expected Tipset"," ",r.a.createElement("a",{href:"https://filfox.info/en/tipset/".concat(s)},ue(s))),h&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tiny"},"Drand Status"," ",r.a.createElement("span",null,h.current<h.expected?"catching up":"ok")),r.a.createElement("div",{className:"tiny"},"Current Drand"," ",r.a.createElement("a",{href:"https://api.drand.sh/public/".concat(h.current)},ue(h.current))),r.a.createElement("div",{className:"tiny"},"Expected Drand"," ",r.a.createElement("a",{href:"https://api.drand.sh/public/".concat(h.expected)},ue(h.expected)))))}a(150),a(151);var pe=function(){console.log("reloaded");var e=Object(n.useState)(),t=Object(u.a)(e,2),a=t[0],c=t[1],i=Object(n.useState)(),s=Object(u.a)(i,2),p=s[0],h=s[1],f=Object(n.useState)("wss://node.glif.io/space07/lotus/rpc/v0"),v=Object(u.a)(f,2),E=v[0],w=(v[1],Object(n.useState)(new _(E))),b=Object(u.a)(w,2),y=b[0],g=b[1],j=Object(n.useState)(),O=Object(u.a)(j,2),x=O[0];return O[1],Object(n.useEffect)((function(){(function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:return e.next=4,g(new _(E));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[E]),Object(n.useEffect)((function(){var e=!0;y.getMiners().then((function(t){e&&c(t)}));var t=function(){var t=Object(l.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:y.fetchHead().then((function(t){e&&(p&&t.Height===p.Height?console.log("   repeated block, skip"):(console.log("   new block",t.Height,p&&p.Height),h(t)))}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t();var a=setInterval((function(){e&&t()}),5e3);return function(){e=!1,clearInterval(a),console.log("removing interval")}}),[y,p]),r.a.createElement(d.a,null,r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"container"},r.a.createElement(me,{client:y,head:p})),r.a.createElement("header",{className:"container-fluid"},r.a.createElement(d.b,{to:"/"},r.a.createElement("h1",{id:"logo",className:"logo"},r.a.createElement("span",null,"spacegap")))),r.a.createElement(m.c,null,r.a.createElement(m.a,{path:"/miners/:minerId/deadlines/:deadlineId"},r.a.createElement(ne,{client:y,miners:a,head:p})),r.a.createElement(m.a,{path:"/miners/:minerId"},r.a.createElement(se,{client:y,miners:a,head:p})),r.a.createElement(m.a,{path:"/full"},r.a.createElement(X,{client:y,miners:a})),r.a.createElement(m.a,{path:"/status"},r.a.createElement(K,{head:p,spa:x,client:y,miners:a})),r.a.createElement(m.a,{path:"/"},r.a.createElement(z,{client:y,head:p,miners:a})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(pe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},86:function(e,t,a){e.exports=a(152)},91:function(e,t,a){}},[[86,1,2]]]);
//# sourceMappingURL=main.34b590bb.chunk.js.map