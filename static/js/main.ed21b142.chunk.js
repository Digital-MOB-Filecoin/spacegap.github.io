(this.webpackJsonpspacegap=this.webpackJsonpspacegap||[]).push([[0],{104:function(e,t){},111:function(e,t){},117:function(e,t){},119:function(e,t){},147:function(e,t,n){},155:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(81),s=n.n(c),i=(n(93),n(24)),o=n(6),l=n(1),u=n.n(l),d=n(4),m=n(3),p=n(55),f=n(30),v=n(5),h=n(52),E=n(40),b=n(82),j=n.n(b),w=n(78),O=w.format("0.2f"),S=n(79).testnet.fullNode,y=new E.a("wss://lotus.jimpick.com/spacerace_api/0/node/rpc/v0"),x=new h.LotusRPC(y,{schema:S}),g={type:"hamt",key:"bigint",value:{info:{seal_proof:"int",sector_number:"int",sealed_cid:"cid",seal_rand_epoch:"int",deal_ids:["list","int"],expiration:"int",replace_capacity:"bool",replace_sector_deadline:"int",replace_sector_partition:"int",replace_sector_number:"int"},precommit_deposit:"bigint",precommit_epoch:"int",deal_weight:"bigint",verified_deal_weight:"bigint"}},N=function(){var e=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.chainGetNode(t);case 2:return n=e.sent,e.abrupt("return",n.Obj);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(d.a)(u.a.mark((function e(t,n,a){var r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.Blocks[0].ParentStateRoot["/"],e.next=3,x.chainGetNode("".concat(r,"/").concat(n));case 3:return c=e.sent.Obj,e.next=6,j.a.methods.decode(a,c).asObject(N);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),C=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.chainHead();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var a,r,c,s,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.StateReadState(t,n.Cids);case 2:return a=e.sent,r=a.State.PreCommitDeposits,c=a.State.LockedFunds,s=a.Balance,i=s-r-c,e.abrupt("return",{collateral:O(a.Balance/1e18),available:O(i/1e18),locked:O(c/1e18),precommitdeposits:O(r/1e18)});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=window.localStorage.getItem("miners"))){e.next=3;break}return e.abrupt("return",JSON.parse(t));case 3:return e.next=5,fetch("https://filfox.info/api/v0/miner/list/power?pageSize=1000&page=0");case 5:return e.next=7,e.sent.json();case 7:return n=e.sent,a=n.miners.reduce((function(e,t){return e[t.address]=t,e}),{}),window.localStorage.setItem("miners",JSON.stringify(a)),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var a,r,c,s,l,d,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([x.StateMinerProvingDeadline(t,n.Cids),x.StateMinerDeadlines(t,n.Cids)]);case 2:return a=e.sent,r=Object(m.a)(a,2),c=r[0],s=r[1],l=Object(i.a)(Array(48)).map((function(e,t){return Object(o.a)(Object(o.a)({},s[(c.Index+t)%48]),{},{Close:c.Close+60*t})})).map((function(e){return{Close:e.Close,LiveSectors:e.LiveSectors,TotalSectors:e.TotalSectors,FaultyPower:e.FaultyPower}})),d=s.map((function(e){return+e.LiveSectors})).reduce((function(e,t){return e+t}),0),p=s.map((function(e){return+e.FaultyPower.Raw})).reduce((function(e,t){return e+t}),0)/34359738368,e.abrupt("return",{nextDeadlines:l,SectorsCount:d,FaultsCount:p,ActiveCount:d-p});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(n,"@Ha:".concat(t,"/1/5"),g);case 2:return a=e.sent,r=w.groups(Object.keys(a).map((function(e){return{SectorNumber:a[e].info.sector_number,Expiry:a[e].precommit_epoch+10210}})),(function(e){return e.Expiry})).map((function(e){var t=Object(m.a)(e,2);return{Expiry:t[0],Sectors:t[1].map((function(e){return e.SectorNumber}))}})).sort((function(e,t){return e.Expiry-t.Expiry})),e.abrupt("return",{PreCommitDeadlines:r,Count:Object.keys(a).length});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var a,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.StateMinerSectors(t,null,null,n.Cids);case 2:return a=e.sent,r=a.reduce((function(e,t){return e[t.ID]={number:t.ID,info:t},e}),{}),c=Object.keys(r).length,e.abrupt("return",{sectorsCount:c,Sectors:r});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),M=n(85),D=n.n(M),A=(n(146),n(147),n(86)),B=n.n(A),T=n(78).format(",");function H(){var e=Object(a.useState)({}),t=Object(m.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)({}),i=Object(m.a)(s,2),l=i[0],p=i[1],v=Object(a.useState)(),h=Object(m.a)(v,2),E=h[0],b=h[1];return Object(a.useEffect)((function(){P().then((function(e){c(e)}))}),[]),Object(a.useEffect)((function(){(function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C();case 2:t=e.sent,b(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(a.useEffect)((function(){var e=!0;if(E){var t=Object.keys(n).slice(0,50).map((function(e){return n[e].address}));return B()(5,t,function(){var t=Object(d.a)(u.a.mark((function t(n){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,I(n,E);case 4:if(a=t.sent,e){t.next=7;break}return t.abrupt("return");case 7:return l[n]=a,t.next=10,p(Object(o.a)({},l));case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),function(){e=!1}}}),[E,n]),Object(a.useEffect)((function(){console.log(l)}),[l]),r.a.createElement("section",{id:"LookUp",className:"container"},"Listing WindowPoSt duties of the top 50 miners.",n&&Object.keys(n).slice(0,50).map((function(e){return r.a.createElement("div",null,r.a.createElement(f.b,{to:"/miners/".concat(n[e].address)},n[e].address),r.a.createElement(J,{deadlines:l[n[e].address],head:E}))})))}function R(){var e=Object(a.useState)(),t=Object(m.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){P().then((function(e){c(e)}))}),[]),r.a.createElement("section",{id:"home",className:"container"},r.a.createElement("div",{class:"spacerace"},"Top miners:",n&&Object.keys(n).slice(0,5).map((function(e,t){return r.a.createElement("div",null,t+1,". ",r.a.createElement(f.b,{to:"/miners/".concat(n[e].address)},n[e].address))}))),r.a.createElement("div",null,"See deadlines of ",r.a.createElement(f.b,{to:"/full"},"top 50 miners")," or click on individual miners."))}var W=function(e){e.condition;var t=e.title,n=e.desc;return r.a.createElement("div",{className:"summary col-sm"},r.a.createElement("div",{className:"summary-title"},t),r.a.createElement("div",{className:"summary-desc"},n))},J=function(e){var t=e.deadlines,n=e.head;return r.a.createElement("div",{className:"deadlines windowpost"},t&&t.nextDeadlines.map((function(e){return r.a.createElement("div",{className:0===e.TotalSectors?"deadline opacity5":"deadline"},r.a.createElement("div",{className:"out"},"In ",e.Close-n.Height),r.a.createElement("div",{className:"hddWrapper"},r.a.createElement("div",{className:"in"},Math.round(32*e.TotalSectors/1024)," TiB"),r.a.createElement("div",{className:"hdds"},Object(i.a)(Array(Math.ceil(Math.round(32*e.TotalSectors/1024-+e.FaultyPower.Raw/1099511627776)/8))).map((function(e){return r.a.createElement("div",{className:"hdd"})})),Object(i.a)(Array(Math.ceil(Math.round(+e.FaultyPower.Raw/1099511627776)/8))).map((function(e){return r.a.createElement("div",{className:"hdd faulty"})})))))})))},G=function(){var e=Object(v.f)().minerId,t=Object(a.useState)(),n=Object(m.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)(),l=Object(m.a)(i,2),f=l[0],h=l[1];Object(a.useEffect)((function(){P().then((function(e){h(e)}))}),[]),Object(a.useEffect)((function(){var e=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C();case 2:t=e.sent,s(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e();var t=setInterval((function(){return e()}),3e4);return function(){return clearInterval(t)}}),[]);var E=r.a.useRef(null),b=r.a.useState(null),j=Object(m.a)(b,2),w=j[0],O=j[1],S=Object(a.useState)({id:e}),y=Object(m.a)(S,2),x=y[0],g=y[1];return Object(a.useEffect)((function(){if(e&&c){var t=!0;return g(Object(o.a)({},x)),I(e,c).then((function(e){t&&(x.deadlines=e,g(Object(o.a)({},x)))})),_(e,c).then((function(e){t&&(x.deposits=e,g(Object(o.a)({},x)))})),L(e,c).then((function(e){t&&(x.preCommits=e,g(Object(o.a)({},x)))})),F(e,c).then((function(e){t&&(x.sectors=e,g(Object(o.a)({},x)))})),function(){t=!1}}}),[c,e]),Object(a.useEffect)((function(){if(E.current){D.a.render({seed:x.id},E.current);var e=E.current.getContext("2d");e&&O(e)}}),[w,x]),x?r.a.createElement("div",null,r.a.createElement("div",{id:"miner",className:"section"},r.a.createElement("h1",null,x.id),r.a.createElement("div",null,f&&f[x.id].tag&&r.a.createElement("span",{className:"miner-name"},f[x.id].tag.en),f&&f[x.id].location&&r.a.createElement("span",null," from ",f[x.id].location.flagEmoji),"\xa0 (",r.a.createElement("a",{target:"_blank",href:"https://filfox.info/en/address/".concat(x.id)},"filfox"),",\xa0",r.a.createElement("a",{href:"https://filscan.io/#/tipset/address-detail?address=".concat(x.identicon)},"filscan"),",\xa0",r.a.createElement("a",{href:"https://filscout.io/en/pc/account?id=".concat(x.id)},"filscout"),")"),r.a.createElement("div",null,c&&r.a.createElement("span",null,"Height ",r.a.createElement("a",{href:"https://filfox.info/en/tipset/".concat(c.Height)},c.Height)))),r.a.createElement("div",{id:"deposits",className:"section"},r.a.createElement("div",{className:"grid"},x.deposits&&r.a.createElement(W,{title:T(x.deposits.collateral||0),desc:"Collateral"}),x.deposits&&r.a.createElement(W,{title:T(x.deposits.available||0),desc:"Available"}),x.deposits&&r.a.createElement(W,{title:T(x.deposits.locked||0),desc:"Locked"}))),r.a.createElement("div",{id:"sectors"},r.a.createElement("div",{className:"grid"},x.deadlines&&r.a.createElement(W,{title:T(x.deadlines.SectorsCount||0),desc:"Live Sectors"}),x.deadlines&&r.a.createElement(W,{title:T(x.deadlines.ActiveCount||0),desc:"Active Sectors"}),x.deadlines&&r.a.createElement(W,{title:T(x.deadlines.FaultsCount||0),desc:"Faulty Sectors"}),x.preCommits&&r.a.createElement(W,{title:T(x.preCommits.Count||0),desc:"PreCommits"}))),r.a.createElement("div",{className:"section wpost"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col section-title"},r.a.createElement("h3",null,"WindowPoSt due"),r.a.createElement("a",{"data-tip":!0,"data-for":"wpost-desc"},"(what is this?)"),r.a.createElement(p.a,{id:"wpost-desc",effect:"solid",place:"top"},r.a.createElement("span",null,"List of 48 WindoPoSt submission deadlines ordered by due time (in epochs).",r.a.createElement("br",null),"Bars represent ~8TB disks to be proven, white are healthy disks, red are faulty.")))),r.a.createElement(J,{deadlines:x.deadlines,head:c})),r.a.createElement("div",{id:"provecommit",className:"section"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col section-title"},r.a.createElement("h3",null,"ProveCommits due"),r.a.createElement("a",{"data-tip":!0,"data-for":"provecommit-desc"},"(what is this?)"),r.a.createElement(p.a,{id:"provecommit-desc",effect:"solid",place:"top"},r.a.createElement("span",null,"List of ProveCommits ordered by due time (in epochs).",r.a.createElement("br",null),"Circles represent sectors to be proven.")))),r.a.createElement("div",{className:"deadlines provecommit"},x.preCommits&&x.preCommits.PreCommitDeadlines.map((function(e){return r.a.createElement("div",{className:"deadline"},r.a.createElement("div",{className:"out"},"In ",e.Expiry-c.Height),r.a.createElement("div",{className:"hddWrapper"},r.a.createElement("div",{className:"in"},Math.round(e.Sectors.length)," sectors"),r.a.createElement("div",{className:"hdds"},e.Sectors.map((function(e){return r.a.createElement("div",{id:e,className:"hdd ".concat(!!x.sectors&&!!x.sectors.Sectors[e])},215428==e?x.sectors&&x.sectors.Sectors[e]:"")})))))}))))):r.a.createElement(r.a.Fragment,null)},z=function(){return r.a.createElement(f.a,null,r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"container-fluid"},r.a.createElement(f.b,{to:"/"},r.a.createElement("h1",{id:"logo",className:"logo"},r.a.createElement("span",null,"spacegap")))),r.a.createElement(v.c,null,r.a.createElement(v.a,{path:"/miners/:minerId"},r.a.createElement("section",{className:"container"},r.a.createElement(G,null))),r.a.createElement(v.a,{path:"/full"},r.a.createElement(H,null)),r.a.createElement(v.a,{path:"/"},r.a.createElement(R,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},88:function(e,t,n){e.exports=n(155)},93:function(e,t,n){}},[[88,1,2]]]);
//# sourceMappingURL=main.ed21b142.chunk.js.map