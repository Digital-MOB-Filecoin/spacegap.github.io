(this.webpackJsonpspacegap=this.webpackJsonpspacegap||[]).push([[0],{109:function(e,t){},111:function(e,t){},139:function(e,t,a){},145:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(76),s=a.n(c),i=(a(88),a(22)),o=a(5),l=a(1),u=a.n(l),d=a(4),m=a(2),p=a(81),f=a(3),v=a(51),h=a(40),E=a(77),b=a.n(E),w=a(74),j=w.format("0.2f"),O=a(75).testnet.fullNode,g=new h.a("wss://lotus.jimpick.com/spacerace_api/0/node/rpc/v0"),S=new v.LotusRPC(g,{schema:O}),N={type:"hamt",key:"bigint",value:{info:{seal_proof:"int",sector_number:"int",sealed_cid:"cid",seal_rand_epoch:"int",deal_ids:["list","int"],expiration:"int",replace_capacity:"bool",replace_sector_deadline:"int",replace_sector_partition:"int",replace_sector_number:"int"},precommit_deposit:"bigint",precommit_epoch:"int",deal_weight:"bigint",verified_deal_weight:"bigint"}},y=function(){var e=Object(d.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.chainGetNode(t);case 2:return a=e.sent,e.abrupt("return",a.Obj);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=Object(d.a)(u.a.mark((function e(t,a,n){var r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.Blocks[0].ParentStateRoot["/"],e.next=3,S.chainGetNode("".concat(r,"/").concat(a));case 3:return c=e.sent.Obj,e.next=6,b.a.methods.decode(n,c).asObject(y);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),C=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.chainHead();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r,c,s,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.StateReadState(t,a.Cids);case 2:return n=e.sent,r=n.State.PreCommitDeposits,c=n.State.LockedFunds,s=n.Balance,i=s-r-c,e.abrupt("return",{collateral:j(n.Balance/1e18),available:j(i/1e18),locked:j(c/1e18),precommitdeposits:j(r/1e18)});case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),_=function(){var e=Object(d.a)(u.a.mark((function e(){var t,a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=window.localStorage.getItem("miners"))){e.next=3;break}return e.abrupt("return",JSON.parse(t));case 3:return e.next=5,fetch("https://filfox.info/api/v0/miner/list/power?pageSize=1000&page=0");case 5:return e.next=7,e.sent.json();case 7:return a=e.sent,n=a.miners.reduce((function(e,t){return e[t.address]=t,e}),{}),window.localStorage.setItem("miners",JSON.stringify(n)),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r,c,s,l,d,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([S.StateMinerProvingDeadline(t,a.Cids),S.StateMinerDeadlines(t,a.Cids)]);case 2:return n=e.sent,r=Object(m.a)(n,2),c=r[0],s=r[1],l=Object(i.a)(Array(48)).map((function(e,t){return Object(o.a)(Object(o.a)({},s[(c.Index+t)%48]),{},{Close:c.Close+60*t})})).map((function(e){return{Close:e.Close,LiveSectors:e.LiveSectors,TotalSectors:e.TotalSectors,FaultyPower:e.FaultyPower}})),d=s.map((function(e){return+e.LiveSectors})).reduce((function(e,t){return e+t}),0),p=s.map((function(e){return+e.FaultyPower.Raw})).reduce((function(e,t){return e+t}),0)/34359738368,e.abrupt("return",{nextDeadlines:l,SectorsCount:d,FaultsCount:p,ActiveCount:d-p});case 10:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),I=function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(a,"@Ha:".concat(t,"/1/5"),N);case 2:return n=e.sent,r=w.groups(Object.keys(n).map((function(e){return{SectorNumber:n[e].info.sector_number,Expiry:n[e].precommit_epoch+10001}})),(function(e){return e.Expiry})).map((function(e){var t=Object(m.a)(e,2);return{Expiry:t[0],Sectors:t[1].map((function(e){return e.SectorNumber}))}})).sort((function(e,t){return e.Expiry-t.Expiry})),e.abrupt("return",{PreCommitDeadlines:r,Count:Object.keys(n).length});case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),D=function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.StateMinerSectors(t,null,null,a.Cids);case 2:return n=e.sent,console.log("saved",n.filter((function(e){return 215428===e}))),r=n.reduce((function(e,t){return e[t.ID]={number:t.ID,state:"committed",info:t},e}),{}),c=Object.keys(r).length,console.log("got sectors",r),e.abrupt("return",{sectorsCount:c,Sectors:r});case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),F=a(80),M=a.n(F),L=(a(138),a(139),a(74).format(","));function A(){var e=Object(n.useState)(),t=Object(m.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){_().then((function(e){c(e)}))}),[]),r.a.createElement("section",{id:"LookUp",className:"container"},"Dashboard for Proof-of-Space mining",a&&Object.keys(a).slice(0,50).map((function(e){return r.a.createElement("div",null,r.a.createElement("a",{href:"./miners/".concat(a[e].address)},a[e].address))})))}var R=function(e){e.condition;var t=e.title,a=e.desc;return r.a.createElement("div",{className:"summary col-sm"},r.a.createElement("div",{className:"summary-title"},t),r.a.createElement("div",{className:"summary-desc"},a))},B=function(){var e=Object(f.f)().minerId;console.log("bootstrap ",e);var t=Object(n.useState)(),a=Object(m.a)(t,2),c=a[0],s=a[1],l=Object(n.useState)(),p=Object(m.a)(l,2),v=p[0],h=p[1];Object(n.useEffect)((function(){_().then((function(e){h(e)}))}),[]),Object(n.useEffect)((function(){var e=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C();case 2:t=e.sent,s(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e(),setInterval((function(){return e()}),3e4)}),[]);var E=r.a.useRef(null),b=r.a.useState(null),w=Object(m.a)(b,2),j=w[0],O=w[1],g=Object(n.useState)({id:e}),S=Object(m.a)(g,2),N=S[0],y=S[1];return Object(n.useEffect)((function(){if(e&&c){var t=!0;return y(Object(o.a)({},N)),P(e,c).then((function(e){t&&(N.deadlines=e,y(Object(o.a)({},N)))})),k(e,c).then((function(e){t&&(N.deposits=e,y(Object(o.a)({},N)))})),I(e,c).then((function(e){t&&(N.preCommits=e,y(Object(o.a)({},N)))})),D(e,c).then((function(e){t&&(N.sectors=e,y(Object(o.a)({},N)))})),function(){t=!1}}}),[c,e]),Object(n.useEffect)((function(){console.log("spacegap","miner has changed",N)}),[N]),Object(n.useEffect)((function(){if(E.current){M.a.render({seed:N.id},E.current);var e=E.current.getContext("2d");e&&O(e)}}),[j,N]),N?r.a.createElement("div",null,r.a.createElement("div",{id:"miner",className:"section"},r.a.createElement("h1",null,N.id),r.a.createElement("div",null,v&&v[N.id].tag&&r.a.createElement("span",{className:"miner-name"},v[N.id].tag.en),v&&v[N.id].location&&r.a.createElement("span",null," from ",v[N.id].location.flagEmoji),"\xa0 (",r.a.createElement("a",{target:"_blank",href:"https://filfox.info/en/address/".concat(N.id)},"filfox"),",\xa0",r.a.createElement("a",{href:"https://filscan.io/#/tipset/address-detail?address=".concat(N.identicon)},"filscan"),",\xa0",r.a.createElement("a",{href:"https://filscout.io/en/pc/account?id=".concat(N.id)},"filscout"),")")),r.a.createElement("div",{id:"deposits",className:"section"},r.a.createElement("div",{className:"grid"},N.deposits&&r.a.createElement(R,{title:L(N.deposits.collateral||0),desc:"Collateral"}),N.deposits&&r.a.createElement(R,{title:L(N.deposits.available||0),desc:"Available"}),N.deposits&&r.a.createElement(R,{title:L(N.deposits.locked||0),desc:"Locked"}))),r.a.createElement("div",{id:"sectors"},r.a.createElement("div",{className:"grid"},N.deadlines&&r.a.createElement(R,{title:L(N.deadlines.SectorsCount||0),desc:"Live Sectors"}),N.deadlines&&r.a.createElement(R,{title:L(N.deadlines.SectorsCount||0),desc:"Live Sectors"}),N.preCommits&&r.a.createElement(R,{title:L(N.preCommits.Count||0),desc:"PreCommits"}),N.deadlines&&r.a.createElement(R,{title:L(N.deadlines.ActiveCount||0),desc:"Active Sectors"}),N.deadlines&&r.a.createElement(R,{title:L(N.deadlines.FaultsCount||0),desc:"PoSt Faults"}))),r.a.createElement("div",{id:"wpost",className:"section"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h3",null,"WindowPoSt due"))),r.a.createElement("div",{className:"deadlines windowpost"},N.deadlines&&N.deadlines.nextDeadlines.map((function(e){return r.a.createElement("div",{className:0===e.TotalSectors?"deadline opacity5":"deadline"},r.a.createElement("div",{className:"out"},"In ",e.Close-c.Height),r.a.createElement("div",{className:"hddWrapper"},r.a.createElement("div",{className:"in"},Math.round(32*e.TotalSectors/1024)," TiB"),r.a.createElement("div",{className:"hdds"},Object(i.a)(Array(Math.ceil(Math.round(32*e.TotalSectors/1024-+e.FaultyPower.Raw/1099511627776)/8))).map((function(e){return r.a.createElement("div",{className:"hdd"})})),Object(i.a)(Array(Math.ceil(Math.round(+e.FaultyPower.Raw/1099511627776)/8))).map((function(e){return r.a.createElement("div",{className:"hdd faulty"})})))))})))),r.a.createElement("div",{id:"provecommit",className:"section"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h3",null,"ProveCommits due"))),r.a.createElement("div",{className:"deadlines provecommit"},N.preCommits&&N.preCommits.PreCommitDeadlines.map((function(e){return r.a.createElement("div",{className:"deadline"},r.a.createElement("div",{className:"out"},"In ",e.Expiry-c.Height),r.a.createElement("div",{className:"hddWrapper"},r.a.createElement("div",{className:"in"},Math.round(e.Sectors.length)," sectors"),r.a.createElement("div",{className:"hdds"},e.Sectors.map((function(e){return r.a.createElement("div",{id:e,className:"hdd ".concat(!!N.sectors&&!!N.sectors.Sectors[e])},215428==e?N.sectors&&N.sectors.Sectors[e]:"")})))))}))))):r.a.createElement(r.a.Fragment,null)},T=function(){return r.a.createElement(p.a,null,r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"container-fluid"},r.a.createElement("a",{href:"/"},r.a.createElement("h1",{id:"logo",className:"logo"},"spacegap"))),r.a.createElement(f.c,null,r.a.createElement(f.a,{path:"/miners/:minerId"},r.a.createElement("section",{className:"container"},r.a.createElement(B,null))),r.a.createElement(f.a,{path:"/"},r.a.createElement(A,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},83:function(e,t,a){e.exports=a(145)},88:function(e,t,a){},97:function(e,t){}},[[83,1,2]]]);
//# sourceMappingURL=main.ada18c62.chunk.js.map